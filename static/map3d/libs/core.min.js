"use strict";var _createClass=function(){function i(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}if(void 0===dl){var dl={};window.dl=dl}dl.version="0.0.6",console.info("DILU TECH SDK "+dl.version),dl.defined=function(e){return void 0!==e&&null!=e||(console.warn(e+" is undefined."),!1)},dl.defaultValue=function(e,t){return null!=e?e:t},dl.DeveloperError=function(e){var t;this.name="DeveloperError",this.message=e;try{throw new Error}catch(e){t=e.stack}this.stack=t},dl.defined(Object.create)&&(dl.DeveloperError.prototype=Object.create(Error.prototype),dl.DeveloperError.constructor=dl.DeveloperError),dl.DeveloperError.prototype.toString=function(){var e=this.name+": "+this.message;return dl.defined(this.stack)&&(e+="\n"+this.stack.toString()),e},dl.DeveloperError.throwInstantiationError=function(){throw new dl.DeveloperError("This function defines an interface and should not be called directly.")},dl.styles={lane_arrow:{color:"#06c2ff",width:1},diversion_polyline:{color:"#05F2F2",width:1},crosswalk:{color:"#778C7A",width:3},lane_marking:{color:"#dedede",width:2},trafficlight_point:{color:"#F2C061",size:1},trafficlight_polygon:{color:"#D6B37F",width:1},lane_boundary:{color:"#dedede",width:2},camera:{color:"#eD303C",width:1},pole:{color:"#A47F6F",width:1},trafficlight_polyline:{color:"#A47F6F",width:2},lanemarking_polyline:{color:"#dedede",width:1},sign_ploygon:{color:"#00D49D",width:1},sign_polyline:{color:"#1854FF",width:1},intersection:{color:"#FF974F",width:1},road_polygon:{color:"#253034",width:1},guardrail:{color:"#60FF00",width:1},greenbelt:{color:(new THREE.Color).setHSL(.3,.75,i/15*.4+.1),width:1,map:"./resources/grass2.jpg"}},dl.SYMBOLS={BINGBAO:"../resources/icons/bingbao.png",DAXUE:"../resources/icons/daxue.png",DAYU:"../resources/icons/dayu.png",DUOYUN:"../resources/icons/duoyun.png",FUCHEN:"../resources/icons/fuchen.png",LEIDIAN:"../resources/icons/leidian.png",MAI:"../resources/icons/mai.png",QINGTIAN:"../resources/icons/qingtian.png",TAIFENG:"../resources/icons/taifeng.png",WU:"../resources/icons/wu.png",XIAOXUE:"../resources/icons/xiaoxue.png",XIAOYU:"../resources/icons/xiaoyu.png",YINTIAN:"../resources/icons/yintian.png",ZHENXUE:"../resources/icons/zhenxue.png",ZHENYU:"../resources/icons/zhenyu.png"},dl.debugger=!1,dl.init=function(e){if(e){var t=e.doc,o=new Pt.Viewer(document.getElementById(t));return dl.viewer=o,dl.viewer.setEDLEnabled(e.edl||!1),dl.viewer.setFOV(e.fov||60),dl.viewer.setPointBudget(e.pointbudget||2e6),dl.viewer.setBackground(e.background||"skybox"),dl.viewer.setNavigationMode(e.navMode||Pt.EarthControls),dl.scene=dl.viewer.scene.scene,o}console.error("请输入相关配置")},dl.initView=function(e,t){if(t||(t=dl.viewer),e instanceof Array){var o=new THREE.Vector3(e[0][0],e[0][1],e[0][2]);new THREE.Vector3(e[1][0],e[1][1],e[1][2]);e=new THREE.Box3(o.max)}var i=TWEEN.Easing.Quadratic.InOut,r=new THREE.Object3D;r.boundingBox=e;var n={x:0},s=new TWEEN.Tween(n).to({x:1},200);s.easing(i);var l=t.scene.view.yaw,a=t.scene.view.pitch,u=-Math.PI/2;t.zoomTo(r,1,200),s.onUpdate(function(){var e=n.x;t.scene.view.yaw=(1-e)*l+0*e,t.scene.view.pitch=(1-e)*a+e*u}),s.onComplete(function(){console.log("position",t.scene.view.position)}),s.start()},dl.sleep=function(e){for(var t=new Date,o=t.getTime()+e;;)if((t=new Date).getTime()>o)return},dl.equal=function(e,t){var o=1e-4,i=!0;return Math.abs(e[0]-t[0])>o&&(i=!1),Math.abs(e[1]-t[1])>o&&(i=!1),e[2]&&Math.abs(e[2]-t[2])>o&&(i=!1),i},dl.removeDuplication=function(e){var t=e.length;return 2<t?(e[0]instanceof THREE.Vector3||e[0]instanceof THREE.Vector2?e[0].equals(e[t-1]):dl.equal(e[0],e[t-1]))?(e.pop(),e):void 0:e},dl.changeViewer=function(e){dl.viewer=null,dl.scene=null,dl.viewer=e,dl.scene=dl.viewer.scene.scene},dl.distance=function(e,t){return e instanceof THREE.Vector3?null!=e.z&&null!=t.z?Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)+(e.z-t.z)*(e.z-t.z)):Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)):e instanceof Array?2<e.length&&2<t.length?Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])+(e[2]-t[2])*(e[2]-t[2])):Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])):(console.error("参数不正确."),!1)},dl.getYaw=function(e){return e?e.scene.view.yaw:null},dl.getPitch=function(e){return e?e.scene.view._pitch:null},dl.getRadius=function(e){return e?e.scene.view.radius:null},dl.removeShape=function(e,t){t||(t=dl.viewer),t.scene.scene.remove(e);var o=dl.shapes.indexOf(e);-1<o?dl.shapes.splice(o,1):console.error("未找到shape")},dl.removeModel=function(e,t){t||(t=dl.viewer),t.scene.scene.remove(e);var o=dl.models.indexOf(e);-1<o?dl.models.splice(o,1):console.error("未找到model")},dl.removePointcloud=function(e,t){t||(t=dl.viewer),t.scene.removePointcloud(e);var o=dl.pointclouds.indexOf(e);-1<o?dl.models.splice(o,1):console.error("未找到pointcloud")},dl.computeLength=function(e,t){if(e.length<2)return console.error("points点数少于2."),0;var o=0;if("polyline"==(t=t||"polyline"))for(var i=0,r=e.length-1;i<r;i++)o+=dl.distance(e[i],e[i+1]);else if("polygon"==t)for(var n=0,s=e.length;n<s;n++)for(var l=0,a=e[n].length-1;l<a;l++)o+=dl.distance(e[l],e[l+1]);else console.error("type不正确.");return o},dl.computeArea=function(e){function t(e,t,o){var i=-1,r=[0,0,0];if(r[0]=dl.distance(e,t),r[1]=dl.distance(t,o),r[2]=dl.distance(o,e),r[0]+r[1]<=r[2]||r[0]+r[2]<=r[1]||r[1]+r[2]<=r[0])return i;var n=(r[0]+r[1]+r[2])/2;return i=Math.sqrt(n*(n-r[0])*(n-r[1])*(n-r[2]))}if(!earcut)return console.error("earcut未定义."),!1;if(e[0]&&e[0][0]){var o=[];if(e[0][0]instanceof THREE.Vector3)for(var i=0,r=e.length;i<r;i++)o.push(e[i].x),o.push(e[i].y),o.push(e[i].z);else if(e[0][0]instanceof Array)for(var n=0,s=e.length;n<s;n++)o.push(e[n][0]),o.push(e[n][1]),o.push(e[n][2]);for(var l=earcut(o,null,3),a=0,u=0,c=l.length-3;u<c;u+=3){var h=t(e[l[u]],e[l[u+1]],e[l[u+2]]);if(h<0)return console.error("多边形可能存在问题."),!1;a+=h}return a}return console.error("数据不正确."),!1},dl.reprojection=function(e,t,o){if(!proj4)return console.error("proj4未定义."),!1;if(e instanceof THREE.Vector3){var i=proj4(t,o,e.toArray());return new THREE.Vector3(i[0],i[1],i[2])}return proj4(t,o,e)},dl.getWgs84=function(e,t){if(!proj4)return console.error("proj4未定义."),!1;var o=null;return o=t?proj4(t.projection,"+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"):proj4(dl.pointclouds[0].projection,"+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e instanceof THREE.Vector3?o.forward(e.toArray()):e instanceof Array?o.forward(e):void 0},dl.moveTo=function(e){var t,o,i,r,n=(e.viewer?e.viewer:dl.viewer).scene.view;TWEEN.Easing.Quartic.Out;t=n.position.clone(),r=n.pitch,o=n.yaw,i=n.radius;var s=dl.defaultValue(e.position,t);s instanceof Array&&(s=new THREE.Vector3(s[0],s[1],s[2]));var l=dl.defaultValue(e.yaw,o),a=dl.defaultValue(e.pitch,r),u=dl.defaultValue(e.radius,i),c=new THREE.Vector3(0,1,0);c.applyAxisAngle(new THREE.Vector3(1,0,0),a),c.applyAxisAngle(new THREE.Vector3(0,0,1),l);var h=c.multiplyScalar(-1);(s=(new THREE.Vector3).addVectors(s,h.multiplyScalar(u)))&&l&&a&&u&&(n.yaw=l,n.pitch=a,n.position.x=s.x,n.position.y=s.y,n.position.z=s.z,n.radius=u)},dl.getScale=function(e){var t,o=e.scene.getActiveCamera(),i=e.renderArea.clientWidth;e.renderArea.clientHeight;t=function(){var e=new Array;if(null!=window.screen.deviceXDPI)e[0]=window.screen.deviceXDPI,e[1]=window.screen.deviceYDPI;else{var t=document.getElementById("dpi");t||((t=document.createElement("DIV")).id="dpi",t.style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden",document.body.appendChild(t)),e[0]=parseInt(t.offsetWidth),e[1]=parseInt(t.offsetHeight)}return e}();var r=0;o.position.clone();if(o instanceof THREE.OrthographicCamera)geodis=Math.abs(o.left-o.right),r=geodis*t[0]/(.0254*i);else if(o instanceof THREE.PerspectiveCamera){var n=o.fov*Math.PI/360;r=e.scene.view.radius*Math.tan(n)*t[0]/(.0254*i*.5)}return Math.floor(Math.abs(r))},dl.Text=function(e){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this)),o=new THREE.Texture;o.minFilter=THREE.LinearFilter,o.magFilter=THREE.LinearFilter;var i=new THREE.SpriteMaterial({map:o,depthTest:!1,depthWrite:!1});return t.texture=o,t.material=i,t.sprite=new THREE.Sprite(i),t.add(t.sprite),t.borderThickness=dl.defaultValue(e.borderThickness,4),t.fontface="Arial",t.fontsize=dl.defaultValue(e.fontsize,28),t.borderColor=dl.defaultValue(e.borderColor,{r:0,g:0,b:0,a:1}),t.backgroundColor=dl.defaultValue(e.backgroundColor,{r:255,g:255,b:255,a:1}),t.textColor=dl.defaultValue(e.textColor,{r:255,g:255,b:255,a:1}),t.text=dl.defaultValue(e.text,""),t.update(),t}return _inherits(r,THREE.Object3D),_createClass(r,[{key:"setText",value:function(e){this.text!==e&&(this.text=e,this.update())}},{key:"setFontface",value:function(e){this.fontface!==e&&(this.fontface=e,this.update())}},{key:"setPositon",value:function(e){e instanceof THREE.Vector3?this.position.copy(e):e instanceof Array&&(this.position.x=e[0],this.position.y=e[1],this.position.z=e[2]?e[2]:10)}},{key:"setTextColor",value:function(e){this.textColor.r=e.r?e.r:255,this.textColor.g=e.g?e.g:255,this.textColor.b=e.b?e.b:255,this.textColor.a=e.a?e.a:1,this.update()}},{key:"setBorderColor",value:function(e){this.borderColor.r=e.r?e.r:0,this.borderColor.g=e.g?e.g:0,this.borderColor.b=e.b?e.b:0,this.borderColor.a=e.a?e.a:1,this.update()}},{key:"setBackgroundColor",value:function(e){this.backgroundColor.r=e.r?e.r:47,this.backgroundColor.g=e.g?e.g:47,this.backgroundColor.b=e.b?e.b:47,this.backgroundColor.a=e.a?e.a:1,this.update()}},{key:"update",value:function(){var e=document.createElement("canvas"),t=e.getContext("2d");t.font="Bold "+this.fontsize+"px "+this.fontface;var o=t.measureText(this.text).width,i=10+o+2*this.borderThickness,r=1.4*this.fontsize+2*this.borderThickness;t.canvas.width=i,t.canvas.height=r,t.font="Bold "+this.fontsize+"px "+this.fontface,t.fillStyle="rgba("+this.backgroundColor.r+","+this.backgroundColor.g+","+this.backgroundColor.b+","+this.backgroundColor.a+")",t.strokeStyle="rgba("+this.borderColor.r+","+this.borderColor.g+","+this.borderColor.b+","+this.borderColor.a+")",t.lineWidth=this.borderThickness,this.roundRect(t,this.borderThickness/2,this.borderThickness/2,o+this.borderThickness+10,1.4*this.fontsize+this.borderThickness,6),t.strokeStyle="rgba(0, 0, 0, 1.0)",t.strokeText(this.text,this.borderThickness+5,this.fontsize+this.borderThickness),t.fillStyle="rgba("+this.textColor.r+","+this.textColor.g+","+this.textColor.b+","+this.textColor.a+")",t.fillText(this.text,this.borderThickness+5,this.fontsize+this.borderThickness);var n=new THREE.Texture(e);n.minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.needsUpdate=!0,this.sprite.material.map=n,this.sprite.scale.set(.01*i,.01*r,1)}},{key:"roundRect",value:function(e,t,o,i,r,n){e.beginPath(),e.moveTo(t+n,o),e.lineTo(t+i-n,o),e.quadraticCurveTo(t+i,o,t+i,o+n),e.lineTo(t+i,o+r-n),e.quadraticCurveTo(t+i,o+r,t+i-n,o+r),e.lineTo(t+n,o+r),e.quadraticCurveTo(t,o+r,t,o+r-n),e.lineTo(t,o+n),e.quadraticCurveTo(t,o,t+n,o),e.closePath(),e.fill(),e.stroke()}}]),r}(),dl.PointCloud=function(){function t(e){_classCallCheck(this,t),this.constructor.counter=void 0===this.constructor.counter?0:this.constructor.counter+1,this.name=e.name||this.constructor.counter,this.url=dl.defaultValue(e.url,""),this.ptColor=dl.defaultValue(e.ptColor,Pt.PointColorType.HEIGHT),this.ptSizeType=e.ptSizeType||Pt.PointSizeType.FIXED,this.shape=e.shape||Pt.PointShape.CIRCLE,this.gradient=e.gradient||Pt.Gradients.RAINBOW,this.size=e.size||1,this.viewer=e.viewer||dl.viewer,this.init()}return _createClass(t,[{key:"init",value:function(){var o=this;if(this.url&&""!=this.url){var i=this;Pt.loadPointCloud(i.url,name,function(e){o.pointcloud=e.pointcloud,dl.pointclouds||(dl.pointclouds=[]),dl.pointclouds.push(e.pointcloud),i.viewer.scene.addPointCloud(e.pointcloud);var t=e.pointcloud.material;t.size=i.size,t.pointColorType=i.ptColor||Pt.PointColorType.INTENSITY,t.intensityRange=i.intensityRange||[0,65535],t.pointSizeType=i.ptSizeType||Pt.PointSizeType.FIXED,t.shape=i.shape||Pt.PointShape.CIRCLE,t.gradient=i.gradient||Pt.Gradients.RAINBOW,i.viewer.fitToScreen()})}else console.error("请输入正确的点云地址")}},{key:"setSize",value:function(e){this.size=e,this.pointcloud.material.size=e}},{key:"setPtColor",value:function(e){"string"==typeof e?(this.ptColor=Pt.PointColorType[e],this.pointcloud.material.pointColorType=this.ptColor):(this.ptColor=e,this.pointcloud.material.pointColorType=e)}},{key:"setSizeType",value:function(e){"string"==typeof e?(this.ptSizeType=Pt.PointSizeType[e],this.pointcloud.material.pointSizeType=this.ptSizeType):(this.ptSizeType=e,this.pointcloud.material.pointSizeType=e)}},{key:"setGradient",value:function(e){"string"==typeof e&&(this.gradient=Pt.PointSizeType[e],this.pointcloud.material.gradient=this.ptColor)}}]),t}(),dl.Model=function(e){function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return t.constructor.counter=void 0===t.constructor.counter?0:t.constructor.counter+1,t.url=dl.defaultValue(e.url,""),t.color=dl.defaultValue(e.color,new THREE.Color("#4B58A6")),t.name=dl.defaultValue(e.name,""),t.speed=dl.defaultValue(e.speed,1),t.heading=dl.defaultValue(e.heading,0),t.needUpdate=dl.defaultValue(e.needUpdate,!1),t.type=dl.defaultValue(e.type,"car"),t.boundingBox=new THREE.Box3,t.load(),t}return _inherits(o,THREE.Object3D),_createClass(o,[{key:"getId",value:function(){return this.id}},{key:"getUrl",value:function(){return this.url}},{key:"getColor",value:function(){return this.color.clone()}},{key:"setColor",value:function(e){if(dl.defined(e)){if(e instanceof THREE.Color)this.color.copy(e);else{var t=new THREE.Color(e);this.color.copy(t)}for(var o=0,i=this.children.length;o<i;o++)this.children[o].material.color.copy(this.color)}}},{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){dl.defined(e)&&(this.name=e)}},{key:"getType",value:function(){return this.type}},{key:"setType",value:function(e){dl.defined(e)&&(this.type=e)}},{key:"getSpeed",value:function(){return this.speed}},{key:"setSpeed",value:function(e){dl.defined(e)&&(this.speed=e)}},{key:"getHeading",value:function(){return this.heading}},{key:"setHeading",value:function(e){dl.defined(e)&&(this.heading=e,this.setRotationFromAxisAngle(new THREE.Vector3(0,0,1),e))}},{key:"getUpdate",value:function(){return this.needUpdate}},{key:"setUpdate",value:function(e){dl.defined(e)&&(this.needUpdate=e)}},{key:"setPosition",value:function(e){if(dl.defined(e))if(e instanceof THREE.Vector3)this.position.copy(e);else{if(!(e instanceof Array))return!1;this.position.fromArray(e)}}},{key:"load",value:function(e){var t=this;if("3ds"==t.url.slice(-3).toLowerCase()&&(e="3ds"),"/"===t.url.slice(-1))t.path=t.url;else if("."===t.url.slice(-4,-3)){var o=t.url.split("/");o.pop(),t.path=o.join("/")}"/"!=t.path.slice(-1)&&(t.path=t.path+"/"),t.color instanceof THREE.Color||(t.color=new THREE.Color(t.color)),null==e&&(e="obj");var i=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;console.log(Math.round(t,2)+"% downloaded")}},r=function(e){};if("3ds"==e){var n=new THREE.TDSLoader;n.setPath(t.path),n.load(t.url,function(e){dl.models||(dl.models=[]),dl.models.push(t),t.add(e),e.rotateZ(.5*Math.PI),e.traverse(function(e){e instanceof THREE.Mesh&&(0<=e.name.toLowerCase().indexOf("body")&&e.material.color.copy(t.color),e.geometry.computeBoundingBox(),e.geometry.computeBoundingSphere(),t.boundingBox.union(e.geometry.boundingBox))})},i,r)}else"obj"==e&&(THREE.Loader.Handlers.add(/\.dds$/i,new THREE.DDSLoader),(new THREE.MTLLoader).setPath(t.path).load(t.name+".mtl",function(e){e.preload(),(new THREE.OBJLoader).setMaterials(e).setPath(t.path).load(t.name+".obj",function(e){dl.models||(dl.models=[]),dl.models.push(t),e.rotateZ(.5*Math.PI),e.traverse(function(e){e instanceof THREE.Mesh&&(0<=e.name.toLowerCase().indexOf("body")&&e.material.color.copy(t.color),e.geometry.computeBoundingBox(),e.geometry.computeBoundingSphere(),t.boundingBox.union(e.geometry.boundingBox))}),t.add(e)},i,r)}))}},{key:"update",value:function(){if(this.needUpdate){var e=new THREE.Vector3(Math.sin(this.heading),Math.cos(this.heading),0).multiplyScalar(this.speed);this.setPosition((new THREE.Vector3).addVectors(e,this.position))}}},{key:"dispose",value:function(){for(var e=0,t=this.children.length;e<t;e++)this.remove(this.children[e]),this.children[e]=null}}]),o}(),dl.TrafficLight=function(e){function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return t.constructor.counter=void 0===t.constructor.counter?0:t.constructor.counter+1,e=e||{},t.name=e.name||"",t.group=[],t.status=1,t.init(),t}return _inherits(o,THREE.Object3D),_createClass(o,[{key:"init",value:function(){this.group.push(this._createLight("red")),this.group.push(this._createLight("yellow")),this.group.push(this._createLight("green")),this.setStatus(this.status)}},{key:"setPosition",value:function(e){if(e instanceof THREE.Vector3)this.position.copy(e);else{if(!(e instanceof Array))return!1;this.position.setFromArray(e)}}},{key:"setName",value:function(e){dl.defined(e)&&(this.name=e)}},{key:"setVisible",value:function(e){dl.defined(e)&&(this.visible=e)}},{key:"setStatus",value:function(e){if("red"==e||1==e)this.group[0].material.color.setRGB(1,0,0),this.group[1].material.color.setRGB(0,0,0),this.group[2].material.color.setRGB(0,0,0);else if("yellow"==e||2==e)this.group[0].material.color.setRGB(0,0,0),this.group[1].material.color.setRGB(1,1,0),this.group[2].material.color.setRGB(0,0,0);else{if("green"!=e&&3!=e)return!1;this.group[0].material.color.setRGB(0,0,0),this.group[1].material.color.setRGB(0,0,0),this.group[2].material.color.setRGB(0,1,0)}}},{key:"_createLight",value:function(e){var t=new THREE.SphereGeometry(1,16,16),o=new THREE.MeshBasicMaterial,i=new THREE.Mesh(t,o);if(i.scale.x=.25,i.scale.y=.25,i.scale.z=.25,"red"==e)o.color.setRGB(1,0,0),i.name="red",i.position.z=1.5;else if("yellow"==e)o.color.setRGB(1,1,0),i.name="yellow",i.position.z=.75;else{if("green"!=e)return null;o.color.setRGB(0,1,0),i.name="green",i.position.z=0}return this.add(i),i}}]),o}(),dl.Texture=function(e){function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return t.url=dl.defaultValue(e.url,null),t.size=dl.defaultValue(e.size,1),t.visible=dl.defaultValue(e.visible,!0),t.repeat=dl.defaultValue(e.repeat,[1,1]),t.texture=null,t.sprite=null,t.initTexture(),t}return _inherits(o,THREE.Object3D),_createClass(o,[{key:"initTexture",value:function(){if(!this.url)return console.error("未设置url"),!1;var e=(new THREE.TextureLoader).load(this.url);e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.repeat.set(this.repeat[0],this.repeat[1]),this.texture=e;var t=new THREE.SpriteMaterial({map:e,color:16777215}),o=new THREE.Sprite(t);this.sprite=o,this.add(o)}},{key:"setVisible",value:function(e){this.visible=e}},{key:"getVisible",value:function(){return this.visible}},{key:"setSize",value:function(e){this.size=e,this.scale.x=e,this.scale.y=e,this.scale.z=e}},{key:"getSize",value:function(){return this.size}},{key:"dispose",value:function(){this.texture=null,this.sprite.material.dispose(),this.remove(sprite),this.sprite=null}}]),o}(),dl.Shape=function(e){function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return t.constructor.counter=void 0===t.constructor.counter?0:t.constructor.counter+1,t.url=dl.defaultValue(e.url,""),t.color=dl.defaultValue(e.color,new THREE.Color),t.width=dl.defaultValue(e.width,1),t.size=dl.defaultValue(e.size,6),t.name=dl.defaultValue(e.name,""),t.visible=dl.defaultValue(e.visible,!0),t.map=e.map?(new THREE.TextureLoader).load(map):null,t.proj=dl.defaultValue(e.proj,proj4.defs("shp","+proj=tmerc +datum=WGS84 +units=m +no_defs")),t.type=null,t.load(),t}return _inherits(o,THREE.Object3D),_createClass(o,[{key:"getId",value:function(){return this.id}},{key:"getUrl",value:function(){return this.url}},{key:"getColor",value:function(){return this.color.clone()}},{key:"setColor",value:function(e){if(dl.defined(e)){if(e instanceof THREE.Color)this.color.copy(e);else{var t=new THREE.Color(e);this.color.copy(t)}for(var o=0,i=this.children.length;o<i;o++)this.children[o].material.color.copy(this.color)}}},{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){dl.defined(e)&&(this.name=e)}},{key:"getType",value:function(){return this.type}},{key:"setVisible",value:function(e){dl.defined(e)&&(this.visible=e)}},{key:"load",value:function(){var i=this;dl.shapes||(dl.shapes=[]),dl.shapes.push(i),Pt.utils.loadShapefileFeatures(i.url,function(e){for(var t in e){var o=e[t];i.featureToSceneNode(o)}})}},{key:"featureToSceneNode",value:function(e){var t=this,o=e.geometry,E=t.color,i=t.width,r=t.map;if(!e.geometry)return null;if("point"===e.geometry.type.toLowerCase()||"pointz"===e.geometry.type.toLowerCase()){t.type="point";var n=[];2<o.coordinates.length?n.push(o.coordinates[0],o.coordinates[1],o.coordinates[2]):n.push(o.coordinates[0],o.coordinates[1],20);var s=new THREE.BufferGeometry;s.addAttribute("position",new THREE.Float32BufferAttribute(n,3)),n=[];var l=new THREE.PointsMaterial({size:t.size,blending:THREE.AdditiveBlending,depthTest:!0,transparent:!1,color:E,sizeAttenuation:!1}),a=new THREE.Points(s,l);t.add(a)}else if("LineString"===o.type||"MultiLineString"===o.type)if(t.type="line","linestring"===o.type.toLowerCase()){var u=P(o.coordinates,i);t.add(u)}else if("multilinestring"===o.type.toLowerCase())for(var c=0,h=o.coordinates.length;c<h;c++){var d=P(o.coordinates[c],i);t.add(d)}else console.info("error line");else if("polygon"===o.type.toLowerCase()){var p=!0,f=!(t.type="polygon"),y=void 0;try{for(var v,g=o.coordinates[Symbol.iterator]();!(p=(v=g.next()).done);p=!0){var T=v.value;t.removeDupEndPts(T);for(var w=[],m=[],R=new THREE.Vector3(1/0,1/0,1/0),b=0;b<T.length;b++){2<T[b].length?(R.x=Math.min(R.x,T[b][0]),R.y=Math.min(R.y,T[b][1]),R.z=Math.min(R.z,T[b][2]),w.push(T[b][0],T[b][1],T[b][2]),m.push(T[b][0],T[b][1],T[b][2])):(R.x=Math.min(R.x,T[b][0]),R.y=Math.min(R.y,T[b][1]),R.z=Math.min(R.z,20),w.push(T[b][0],T[b][1],20),m.push(T[b][0],T[b][1],20))}for(var H=0;H<w.length;H+=3)w[H+0]-=R.x,w[H+1]-=R.y,w[H+2]-=R.z;for(var C=0;C<m.length;C+=3)m[C+0]-=R.x,m[C+1]-=R.y,m[C+2]-=R.z;var x=earcut(m,null,3),k=new Float32Array(w),_=new Float32Array(m);w=[],m=[];var V=new THREE.BufferGeometry;V.addAttribute("position",new THREE.BufferAttribute(k,3));var M=new THREE.LineBasicMaterial({color:(new THREE.Color).sub(E),linewidth:i}),z=new THREE.LineSegments(V,M);z.position.copy(R),t.add(z);var B=new THREE.BufferGeometry;B.addAttribute("position",new THREE.BufferAttribute(_,3)),B.setIndex(x);var S=void 0;S=r?(r.anisotropy=4,r.wrapS=r.wrapT=THREE.RepeatWrapping,r.repeat.set(4,4),r.minFilter=r.magFilter=THREE.LinearFilter,new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:r,depthTest:!0,depthWrite:!1})):new THREE.MeshBasicMaterial({color:E,side:THREE.FrontSide,opacity:1,depthWrite:!1,transparent:!1});var A=new THREE.Mesh(B,S);A.position.copy(R),A.renderOrder=1,t.add(A)}}catch(e){f=!0,y=e}finally{try{!p&&g.return&&g.return()}finally{if(f)throw y}}}else console.log("unhandled feature: ",e);function P(e,t){for(var o=[],i=[],r=new THREE.Vector3(1/0,1/0,1/0),n=0;n<e.length;n++){2<e[0].length?(o.push(e[n][0],e[n][1],e[n][2]),i.push(e[n][0],e[n][1],e[n][2]),r.x=Math.min(r.x,e[n][0]),r.y=Math.min(r.y,e[n][1]),r.z=Math.min(r.z,e[n][2]),0<n&&n<e.length-1&&o.push(e[n][0],e[n][1],e[n][2])):(o.push(e[n][0],e[n][1],20),i.push(e[n][0],e[n][1],20),r.x=Math.min(r.x,e[n][0]),r.y=Math.min(r.y,e[n][1]),r.z=Math.min(r.z,20),0<n&&n<e.length-1&&o.push(e[n][0],e[n][1],20))}if(t<2){for(var s=0;s<o.length;s+=3)o[s+0]-=r.x,o[s+1]-=r.y,o[s+2]-=r.z;var l=new Float32Array(o),a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(l,3));var u=new THREE.LineBasicMaterial({color:E,linewidth:t}),c=new THREE.LineSegments(a,u);return c.position.copy(r),l=null,c}for(var h=0;h<i.length;h+=3)i[h+0]-=r.x,i[h+1]-=r.y,i[h+2]-=r.z;var d=new Float32Array(i),p=new THREE.LineGeometry;p.setPositions(d);var f=new THREE.LineMaterial({color:E,linewidth:t,resolution:new THREE.Vector2(window.innerWidth,window.innerHeight),dashed:!1}),y=new THREE.Line2(p,f);return y.computeLineDistances(),y.scale.set(1,1,1),y.position.copy(r),d=null,y}o=null}},{key:"removeDupEndPts",value:function(e){var t=e.length;2<t&&e[t-1][0]-e[0][0]<=1e-4&&e[t-1][1]-e[0][1]<=1e-4&&e[t-1][2]-e[0][2]<=1e-4&&e.pop()}}]),o}(),dl.Symbols=function(e){function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return t.constructor.counter=void 0===t.constructor.counter?0:t.constructor.counter+1,t.name=dl.defaultValue(e.name,""),t.type=dl.defaultValue(e.type,"QINGTIAN"),t.region=dl.defaultValue(e.region,[]),t.density=dl.defaultValue(e.region,[1,1]),t.height=dl.defaultValue(e.height,10),t.size=dl.defaultValue(e.size,4),t.init(),t}return _inherits(o,THREE.Object3D),_createClass(o,[{key:"init",value:function(){this.type=this.type.toUpperCase(),this.setMap(dl.SYMBOLS[this.type]),this.computeBBox();for(var e=0,t=this.region.length;e<t;e++){var o=this.region[e];this.addSymbol(o)}this.setHeight(this.height)}},{key:"setName",value:function(e){dl.defined(e)&&(this.name=e)}},{key:"setType",value:function(e){dl.defined(e)&&(e=e.toUpperCase(),dl.SYMBOLS[e]?(this.type=e,this.setMap(dl.SYMBOLS[e])):dl.DeveloperError("参数不正确"))}},{key:"setMap",value:function(e){if(dl.defined(e))if("string"==typeof e?this.map=(new THREE.TextureLoader).load(e):e instanceof THREE.Texture&&(this.map=e),this.material)this.material.map=this.map;else{var t=new THREE.SpriteMaterial({map:this.map,depthTest:!1,depthWrite:!1});this.material=t}}},{key:"setHeight",value:function(e){dl.defined(e)&&(this.position.z=e)}},{key:"computeBBox",value:function(){if(this.region.length<4)dl.DeveloperError("region至少需要三个点");else{for(var e=[1/0,1/0],t=[-1/0,-1/0],o=0,i=this.region.length;o<i;o++){var r=this.region[o];r[0]>t[0]&&(t[0]=r[0]),r[1]>t[1]&&(t[1]=r[1]),r[0]<e[0]&&(e[0]=r[0]),r[1]<e[1]&&(e[1]=r[1])}this.bbox=[e,t]}}},{key:"setRegion",value:function(e){if(dl.defined(e)){if(!(e instanceof Array))return void dl.DeveloperError("参数不正确");for(var t=this.region.length,o=e.length,i=0;i<o;i++)i<t?(this.children[i].position.x=e[i][0],this.children[i].position.y=e[i][1]):this.addSymbol(e[i]);if(o<t)for(var r=o;r<t;r++)this.remove(this.children[r])}}},{key:"addSymbol",value:function(e){var t=new THREE.Sprite(this.material);t.position.x=e[0],t.position.y=e[1],t.scale.set(this.size,this.size,1),this.add(t)}}]),o}(),dl.Polygon=function(e){function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return t.constructor.counter=void 0===t.constructor.counter?0:t.constructor.counter+1,t.name=dl.defaultValue(e.name,""),t.color=dl.defaultValue(e.color,new THREE.Color),t.outline=dl.defaultValue(e.outline,!1),t.outlineColor=dl.defaultValue(e.outlineColor,new THREE.Color),t.outlineWidth=dl.defaultValue(e.outlineWidth,1),t.opacity=dl.defaultValue(e.opacity,1),t.rotate=dl.defaultValue(e.rotate,[0,0,0]),t.vertices=dl.defaultValue(e.vertices,[]),t.polygon=null,t.line=null,t}return _inherits(o,THREE.Object3D),_createClass(o,[{key:"updateVertices",value:function(){if(!(2<this.vertices.length))return new Error("多边形至少需要三个点");dl.removeDuplication(this.vertices);for(var e=[],t=[],o=0,i=this.vertices.length;o<i;o++){var r=this.vertices[o];(this.vertices[o]instanceof THREE.Vector3||this.vertices[o]instanceof THREE.Vector2)&&(r=this.vertices[o].toArray()),e.push(r[0]),t.push(r[0]),e.push(r[1]),t.push(r[1]),void 0!==r[2]&&null!=r[2]?(e.push(r[2]),t.push(r[2])):(e.push(10),t.push(10))}this.vertices[0]instanceof THREE.Vector3||this.vertices[0]instanceof THREE.Vector2?(t.push(this.vertices[0].x),t.push(this.vertices[0].y),t.push(this.vertices[0].z?this.vertices[0].z:10)):(t.push(this.vertices[0][0]),t.push(this.vertices[0][1]),t.push(this.vertices[0][2]?this.vertices[0][2]:10));var n=earcut(e,null,3);this.polygon||(this.polygon=new THREE.Mesh(new THREE.BufferGeometry,new THREE.MeshBasicMaterial({side:THREE.DoubleSide}))),this.line||(this.line=new THREE.Line(new THREE.BufferGeometry,new THREE.LineBasicMaterial)),this.polygon.geometry.addAttribute("position",new THREE.Float32BufferAttribute(e,3)),this.polygon.geometry.setIndex(n),this.line.geometry.addAttribute("position",new THREE.Float32BufferAttribute(t,3)),this.polygon.geometry.verticesNeedUpdate=!0}},{key:"setColor",value:function(e){if(dl.defined(e)){if(e instanceof THREE.Color)this.color.copy(e);else{var t=new THREE.Color(e);this.color.copy(t)}this.polygon.material.color.copy(this.color)}}},{key:"setOutline",value:function(e){this.outline=e,this.line.visible=e,this.children.index(this.line)||this.add(this.line)}},{key:"setOutlineColor",value:function(e){if(dl.defined(e&&this.outline)){if(e instanceof THREE.Color)this.outlineColor.copy(e);else{var t=new THREE.Color(e);this.outlineColor.copy(t)}this.line.material.color.copy(this.color)}}},{key:"setOutlineWidth",value:function(e){dl.defined(e)&&this.outline&&(this.outlineWidth=e,this.line.material.width=e)}},{key:"setVisible",value:function(e){dl.defined(e)&&(this.visible=e)}},{key:"setOpacity",value:function(e){this.opacity=e,(this.polygon.material.opacity=e)<1&&(this.polygon.material.transparent=!0)}},{key:"setVertices",value:function(e){this.vertices=null,this.vertices=e,this.updateVertices()}},{key:"setRotate",value:function(e){dl.defined(e)&&(this.rotate=e,this.rotation.x=e[0],this.rotation.y=e[1],this.rotation.z=e[2])}}]),o}(),dl.Geojson=function(e){function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return t.constructor.counter=void 0===t.constructor.counter?0:t.constructor.counter+1,t.url=dl.defaultValue(e.url,""),t.color=dl.defaultValue(e.color,new THREE.Color),t.width=dl.defaultValue(e.width,1),t.size=dl.defaultValue(e.size,6),t.name=dl.defaultValue(e.name,""),t.visible=dl.defaultValue(e.visible,!0),t.map=e.map?(new THREE.TextureLoader).load(map):null,t.proj=dl.defaultValue(e.proj,proj4.defs("shp","+proj=tmerc +datum=WGS84 +units=m +no_defs")),t.type=null,t.load(),t}return _inherits(o,THREE.Object3D),_createClass(o,[{key:"getId",value:function(){return this.id}},{key:"getUrl",value:function(){return this.url}},{key:"getColor",value:function(){return this.color.clone()}},{key:"setColor",value:function(e){if(dl.defined(e)){if(e instanceof THREE.Color)this.color.copy(e);else{var t=new THREE.Color(e);this.color.copy(t)}for(var o=0,i=this.children.length;o<i;o++)this.children[o].material.color.copy(this.color)}}},{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){dl.defined(e)&&(this.name=e)}},{key:"getType",value:function(){return this.type}},{key:"setVisible",value:function(e){dl.defined(e)&&(this.visible=e)}},{key:"load",value:function(){var n=this;dl.shapes||(dl.shapes=[]),dl.shapes.push(n),$.ajax({url:n.url,dataType:"json",success:function(e){var t=e.geometryType;t&&(t=n.typeJson(t));var o=e.features;for(var i in o){var r=o[i];n.featureToGeometry(r,t)}},type:"get"})}},{key:"removeDupEndPts",value:function(e){var t=e.length;2<t&&e[t-1][0]-e[0][0]<=1e-4&&e[t-1][1]-e[0][1]<=1e-4&&e[t-1][2]-e[0][2]<=1e-4&&e.pop()}},{key:"typeJson",value:function(e){switch(e){case"esriGeometryPolygon":return"polygon";case"esriGeometryPolyline":return"polyline";case"esriGeometryPoint":return"point"}}},{key:"featureToGeometry",value:function(e,t){var o=this,i=e.geometry,r=o.color;if(t){if("point"==t){var n=new THREE.SphereGeometry(1,18,18),s=new THREE.MeshNormalMaterial,l=new THREE.Mesh(n,s);l.position.set(i.x.toFixed(4),i.y.toFixed(4),null!=i.z?i.z.toFixed(4):20),o.add(l)}else if("polyline"==t){for(var a=[],u=new THREE.Vector3(1/0,1/0,1/0),c=0;c<i.paths.length;c++)for(var h=i.paths[c],d=0;d<h.length;d++){var p=[h[d][0].toFixed(4),h[d][1].toFixed(4),null!=h[d][2]?h[d][2].toFixed(4):20];a.push.apply(a,p),u.x=Math.min(u.x,p[0]),u.y=Math.min(u.y,p[1]),u.z=Math.min(u.z,p[2]),0<c&&c<i.paths.length-1&&a.push.apply(a,p)}for(var f=0;f<a.length;f+=3)a[f+0]-=u.x,a[f+1]-=u.y,a[f+2]-=u.z;var y=new Float32Array(a),E=new THREE.BufferGeometry;E.addAttribute("position",new THREE.BufferAttribute(y,3));var v=new THREE.LineBasicMaterial({color:r,linewidth:3}),g=new THREE.LineSegments(E,v);g.position.copy(u),o.add(g)}else if("polygon"==t)for(var T=new THREE.Vector3(1/0,1/0,1/0),w=0;w<i.rings.length;w++){for(var m=[],R=[],b=i.rings[w],H=0;H<b.length;H++){var C=[b[H][0].toFixed(4),b[H][1].toFixed(4),null!=b[H][2]?b[H][2].toFixed(4):20];T.x=Math.min(T.x,C[0]),T.y=Math.min(T.y,C[1]),T.z=Math.min(T.z,C[2]),m.push(C[0],C[1],C[2]),R.push(C[0],C[1],C[2]),0<w&&w<b.length-1&&m.push(C[0],C[1],C[2])}for(var x=0;x<m.length;x+=3)m[x].x-=T.x,m[x].y-=T.y,m[x].z-=T.z;for(var k=0;k<R.length;k+=3)R[k].x-=T.x,R[k].y-=T.y,R[k].z-=T.z;var _=(new THREE.BufferGeometry).setFromPoints(m),V=(new THREE.Color).sub(r),M=new THREE.LineBasicMaterial({color:V,linewidth:2}),z=new THREE.Line(_,M);z.position.copy(T),o.add(z);var B=earcut(R,0,3),S=new THREE.BufferGeometry;S.addAttribute("position",new THREE.BufferAttribute(R,0,3)),S.setIndex(B);var A=new THREE.MeshBasicMaterial({color:r,side:THREE.FrontSide}),P=new THREE.Mesh(S,A);P.position.copy(T),o.add(P),m=[],R=[]}}else if("point"==(t=i.type.toLowerCase())||"pointz"==t){var L=new THREE.SphereGeometry(1,18,18),F=new THREE.MeshNormalMaterial,O=new THREE.Mesh(L,F);O.position.set(i.coordinates[0],i.coordinates[1],null!=i.coordinates[2]?i.coordinates[2]:20),o.add(O)}else if("linestring"==t||"linestringz"==t){for(var G=[],j=new THREE.Vector3(1/0,1/0,1/0),D=0;D<i.coordinates.length;D++){var I=i.coordinates[D],N=[I[0],I[1],null!=I[2]?I[2]:20];j.x=Math.min(j.x,N[0]),j.y=Math.min(j.y,N[1]),j.z=Math.min(j.z,N[2]),G.push.apply(G,N),0<D&&D<i.paths.length-1&&G.push.apply(G,N)}for(var W=0;W<G.length;W+=3)G[W+0]-=j.x,G[W+1]-=j.y,G[W+2]-=j.z;var U=new Float32Array(G),q=new THREE.BufferGeometry;q.addAttribute("position",new THREE.BufferAttribute(U,3));var Y=new THREE.LineBasicMaterial({color:r,linewidth:3}),X=new THREE.LineSegments(q,Y);X.position.copy(j),o.add(X)}else if("polygon"==t)for(var Q=new THREE.Vector3(1/0,1/0,1/0),Z=0;Z<i.coordinates.length;Z++){for(var J=[],$=[],K=i.coordinates[Z],ee=0;ee<K.length;ee++){var te=[K[ee][0],K[ee][1],null!=K[ee][2]?K[ee][2]:20];Q.x=Math.min(Q.x,te[0]),Q.y=Math.min(Q.y,te[1]),Q.z=Math.min(Q.z,te[2]),J.push(te[0],te[1],te[2]),$.push(te[0],te[1],te[2]),0<Z&&Z<K.length-1&&J.push(te[0],te[1],te[2])}for(var oe=0;oe<J.length;oe+=3)J[oe].x-=Q.x,J[oe].y-=Q.y,J[oe].z-=Q.z;for(var ie=0;ie<$.length;ie+=3)$[ie].x-=Q.x,$[ie].y-=Q.y,$[ie].z-=Q.z;var re=(new THREE.BufferGeometry).setFromPoints(J),ne=(new THREE.Color).sub(r),se=new THREE.LineBasicMaterial({color:ne,linewidth:2}),le=new THREE.Line(re,se);le.position.copy(Q),o.add(le);var ae=earcut($,0,3),ue=new THREE.BufferGeometry;ue.addAttribute("position",new THREE.BufferAttribute($,3)),ue.setIndex(ae);var ce=new THREE.MeshBasicMaterial({color:r,side:THREE.FrontSide}),he=new THREE.Mesh(ue,ce);he.position.copy(Q),o.add(he),J=[],$=[]}}}]),o}(),dl.Triangle=function(e){function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return t.type="triangle",t.init(),t}return _inherits(o,dl.Polygon),_createClass(o,[{key:"init",value:function(){var e=this.vertices.length;e<3||4<e?dl.DeveloperError("组成三角形的点个数有错误。"):(this.updateVertices(),this.color instanceof THREE.Color||(this.color=new THREE.Color(this.color)),this.outlineColor instanceof THREE.Color||(this.outlineColor=new THREE.Color(this.outlineColor)),this.polygon.material.color.copy(this.color),this.polygon.material.opacity=this.opacity,this.polygon.transparent=this.opacity<1,this.line.material.color.copy(this.outlineColor),this.line.material.width=this.outlineWidth,this.add(this.polygon),this.outline&&this.add(this.line))}}]),o}(),dl.Rectangle=function(e){function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return t.type="rectangle",t.init(),t}return _inherits(o,dl.Polygon),_createClass(o,[{key:"init",value:function(){var e=this.vertices.length;e<2||5<e?dl.DeveloperError("组成距形的点个数有错误。"):(this.computeBBox(),this.vertices.length<4&&(this.vertices=[this.bbox[0],[,this.bbox[1][0],this.bbox[0][1]],this.bbox[1],[this.bbox[0][0],this.bbox[1][1]]]),this.updateVertices(),this.color instanceof THREE.Color||(this.color=new THREE.Color(this.color)),this.outlineColor instanceof THREE.Color||(this.outlineColor=new THREE.Color(this.outlineColor)),this.polygon.material.color.copy(this.color),this.polygon.material.opacity=this.opacity,this.polygon.transparent=this.opacity<1,this.line.material.color.copy(this.outlineColor),this.line.material.width=this.outlineWidth,this.add(this.polygon),this.outline&&this.add(this.line))}},{key:"computeBBox",value:function(){if(this.vertices.length<2||5<this.vertices.length)dl.DeveloperError("rectangle至少需要三个点");else{for(var e=[1/0,1/0],t=[-1/0,-1/0],o=0,i=this.vertices.length;o<i;o++){var r=this.vertices[o];r[0]>t[0]&&(t[0]=r[0]),r[1]>t[1]&&(t[1]=r[1]),r[0]<e[0]&&(e[0]=r[0]),r[1]<e[1]&&(e[1]=r[1])}this.bbox=[e,t]}}}]),o}(),dl.Circle=function(e){function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return t.type="circle",t.redius=dl.defaultValue(e.redius,1),t.center=dl.defaultValue(e.center,[0,0,0]),t.thetaStart=dl.defaultValue(e.thetaStart,0),t.thetaLength=dl.defaultValue(e.thetaLength,2*Math.PI),t.init(),t}return _inherits(o,dl.Polygon),_createClass(o,[{key:"init",value:function(){this.color instanceof THREE.Color||(this.color=new THREE.Color(this.color)),this.outlineColor instanceof THREE.Color||(this.outlineColor=new THREE.Color(this.outlineColor)),this.circleBufferGeometry(this.redius),this.add(this.polygon),this.add(this.line),this.line.visible=this.outline,this.position.x=this.center[0],this.position.y=this.center[1],this.position.z=this.center[2]||0}},{key:"circleBufferGeometry",value:function(e){var t=new THREE.BufferGeometry,o=new THREE.BufferGeometry,i=this.thetaStart,r=this.thetaLength;e=e||1;var n,s,l=[],a=[],u=[],c=[],h=[],d=new THREE.Vector3,p=new THREE.Vector2;for(a.push(0,0,0),u.push(0,0,1),h.push(.5,.5),s=0,n=3;s<=72;s++,n+=3){var f=i+s/72*r;d.x=e*Math.cos(f),d.y=e*Math.sin(f),a.push(d.x,d.y,d.z),c.push([d.x,d.y,d.z]),u.push(0,0,1),p.x=(a[n]/e+1)/2,p.y=(a[n+1]/e+1)/2,h.push(p.x,p.y)}for(n=1;n<=72;n++)l.push(n,n+1,0);t.setIndex(l),t.addAttribute("position",new THREE.Float32BufferAttribute(a,3)),t.addAttribute("normal",new THREE.Float32BufferAttribute(u,3)),t.addAttribute("uv",new THREE.Float32BufferAttribute(h,2));var y=new THREE.MeshBasicMaterial({color:this.color,side:THREE.DoubleSide});this.polygon=new THREE.Mesh(t,y);var E=a.splice(3,0);E.push(E[0],E[1],E[2]),o.addAttribute("position",new THREE.Float32BufferAttribute(E,3)),this.line=new THREE.Line(o,new THREE.LineBasicMaterial({color:this.outlineColor,width:this.outlineWidth})),this.vertices=c}}]),o}(),dl.Sphere=function(e){function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return t.type="sphere",t.redius=dl.defaultValue(e.redius,1),t.center=dl.defaultValue(e.center,[0,0]),t.widthSegments=36,t.heightSegments=36,t.phiStart=dl.defaultValue(e.phiStart,0),t.phiLength=dl.defaultValue(e.phiLength,2*Math.PI),t.thetaStart=dl.defaultValue(e.thetaStart,0),t.thetaLength=dl.defaultValue(e.thetaLength,2*Math.PI),t.outline=!1,t.init(),t}return _inherits(o,dl.Polygon),_createClass(o,[{key:"init",value:function(){this.sphereGeometry(this.redius),this.color instanceof THREE.Color||(this.color=new THREE.Color(this.color)),this.polygon.material.color.copy(this.color),this.polygon.material.opacity=this.opacity,this.polygon.transparent=this.opacity<1,this.add(this.polygon),this.position.x=this.center[0],this.position.y=this.center[1],this.position.z=this.center[2]||10}},{key:"sphereGeometry",value:function(e){var t=new THREE.BufferGeometry;e=e||1;var o,i,r=this.phiStart,n=this.phiLength,s=this.thetaStart,l=this.thetaLength,a=s+l,u=0,c=[],h=new THREE.Vector3,d=new THREE.Vector3,p=[],f=[],y=[],E=[];for(i=0;i<=36;i++){var v=[],g=i/36,T=0==i?.5/36:36==i?-.5/36:0;for(o=0;o<=36;o++){var w=o/36;h.x=-e*Math.cos(r+w*n)*Math.sin(s+g*l),h.y=e*Math.cos(s+g*l),h.z=e*Math.sin(r+w*n)*Math.sin(s+g*l),f.push(h.x,h.y,h.z),d.copy(h).normalize(),y.push(d.x,d.y,d.z),E.push(w+T,1-g),v.push(u++)}c.push(v)}for(i=0;i<36;i++)for(o=0;o<36;o++){var m=c[i][o+1],R=c[i][o],b=c[i+1][o],H=c[i+1][o+1];(0!==i||0<s)&&p.push(m,R,H),(35!==i||a<Math.PI)&&p.push(R,b,H)}t.setIndex(p),t.addAttribute("position",new THREE.Float32BufferAttribute(f,3)),t.addAttribute("normal",new THREE.Float32BufferAttribute(y,3)),t.addAttribute("uv",new THREE.Float32BufferAttribute(E,2)),this.polygon=new THREE.Mesh(t,new THREE.MeshBasicMaterial)}}]),o}(),dl.Cylinder=function(e){function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return t.type="cylinder",t.radiusTop=dl.defaultValue(e.radiusTop,1),t.radiusBottom=dl.defaultValue(e.radiusBottom,1),t.height=dl.defaultValue(e.height,1),t.center=dl.defaultValue(e.center,[0,0]),t.radialSegments=36,t.heightSegments=36,t.thetaStart=dl.defaultValue(e.thetaStart,0),t.thetaLength=dl.defaultValue(e.thetaLength,2*Math.PI),t.outline=!1,t.init(),t}return _inherits(o,dl.Polygon),_createClass(o,[{key:"init",value:function(){if(this.cylinderGeometry(this.radiusTop,this.radiusBottom,this.height,this.thetaStart,this.thetaLength),this.color instanceof THREE.Color)this.polygon.material.color.copy(this.color);else{var e=new THREE.Color(this.color);this.color=e,this.polygon.material.color.copy(this.color)}this.polygon.material.opacity=this.opacity,this.polygon.transparent=this.opacity<1,this.add(this.polygon),this.position.x=this.center[0],this.position.y=this.center[1],this.position.z=this.center[2]||10}},{key:"cylinderGeometry",value:function(v,g,T,w,m){var R=new THREE.BufferGeometry,b=36,H=36;v=void 0!==v?v:1,g=void 0!==g?g:1,T=T||1;w=void 0!==w?w:0,m=void 0!==m?m:2*Math.PI;var C=[],x=[],k=[],_=[],V=0,M=[],z=T/2,B=0;function e(e){var t,o,i,r=new THREE.Vector2,n=new THREE.Vector3,s=0,l=!0===e?v:g,a=!0===e?1:-1;for(o=V,t=1;t<=b;t++)x.push(0,z*a,0),k.push(0,a,0),_.push(.5,.5),V++;for(i=V,t=0;t<=b;t++){var u=t/b*m+w,c=Math.cos(u),h=Math.sin(u);n.x=l*h,n.y=z*a,n.z=l*c,x.push(n.x,n.y,n.z),k.push(0,a,0),r.x=.5*c+.5,r.y=.5*h*a+.5,_.push(r.x,r.y),V++}for(t=0;t<b;t++){var d=o+t,p=i+t;!0===e?C.push(p,p+1,d):C.push(p+1,p,d),s+=3}R.addGroup(B,s,!0===e?1:2),B+=s}!function(){var e,t,o=new THREE.Vector3,i=new THREE.Vector3,r=0,n=(g-v)/T;for(t=0;t<=H;t++){var s=[],l=t/H,a=l*(g-v)+v;for(e=0;e<=b;e++){var u=e/b,c=u*m+w,h=Math.sin(c),d=Math.cos(c);i.x=a*h,i.y=-l*T+z,i.z=a*d,x.push(i.x,i.y,i.z),o.set(h,n,d).normalize(),k.push(o.x,o.y,o.z),_.push(u,1-l),s.push(V++)}M.push(s)}for(e=0;e<b;e++)for(t=0;t<H;t++){var p=M[t][e],f=M[t+1][e],y=M[t+1][e+1],E=M[t][e+1];C.push(p,f,E),C.push(f,y,E),r+=6}R.addGroup(B,r,0),B+=r}(),0<v&&e(!0),0<g&&e(!1),R.setIndex(C),R.addAttribute("position",new THREE.Float32BufferAttribute(x,3)),R.addAttribute("normal",new THREE.Float32BufferAttribute(k,3)),R.addAttribute("uv",new THREE.Float32BufferAttribute(_,2)),this.polygon=new THREE.Mesh(R,new THREE.MeshBasicMaterial)}}]),o}();